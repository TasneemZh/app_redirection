<!DOCTYPE html>
<html>
  <body>
    <script>
      const webhookUrl = 'https://webhook.site/7c6037a8-5adf-4cf1-a8c0-0fd1cfdedf14';

      async function logToWebhook(data) {
        await fetch(webhookUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
      }

      const url = new URL(window.location.href);
      await logToWebhook({ url: url });

      const name = url.searchParams.get('name');
      await logToWebhook({ name: name });

      const destination = url.searchParams.get('destination');
      await logToWebhook({ destination: destination });

      const jumpLink = url.searchParams.get('jumpLink'); // should be encoded to preserve its query params
      await logToWebhook({ jumpLink: jumpLink, encoded: encodeURIComponent(jumpLink) });

      window.onload = async function() {
        if (destination === 'digitalRoutines') {
          await logToWebhook({ destinationResult: 'Digital Routines' });

          window.location.href = `com.gnc.app://push_notification?source=evyd&jumpLink=${encodeURIComponent(jumpLink)}`;
        } else {
          await logToWebhook({ destinationResult: 'Homepage' });

          window.location.href = "com.gnc.app://homepage?source=evyd";
        }

        await logToWebhook({ userAgent: navigator.userAgent });
        if (navigator.userAgent.match(/Android/i)) {
          await logToWebhook({ matchResult: 'Android' });

          setTimeout(function() {
            window.location.href = "intent://play.google.com/store/apps/details?id=com.gnc.android.gnc&pcampaignid=web_redirect#Intent;scheme=https;action=android.intent.action.VIEW;package=com.android.vending;S.browser_fallback_url=https://play.google.com/store/apps/details?id=com.gnc.android.gnc&hl=en&gl=US&pli=1&redirect=0;end";
          }, 1000);
        } else if (navigator.userAgent.match(/iPhone|iPad|iPod/i)) {
          await logToWebhook({ matchResult: 'iPhone|iPad|iPod' });

          setTimeout(function() {
            window.location.href = "https://apps.apple.com/us/app/gnc-livewell/id413258417";
          }, 5000);
        } else if (navigator.userAgent.match(/Windows/i)) {
          await logToWebhook({ matchResult: 'Windows' });

          setTimeout(function() {
            window.location.href = "https://play.google.com/store/apps/details?id=com.gnc.android.gnc&hl=en&gl=US";
          }, 1000);
        } else {
          await logToWebhook({ matchResult: 'Something else' });

          setTimeout(function() {
            window.location.href = "https://apps.apple.com/us/app/gnc-livewell/id413258417";
          }, 5000);
        }

      }
    </script>
  </body>
</html>
