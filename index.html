<!DOCTYPE html>
<html>
  <body>
    <script>
      const webhookUrl = 'https://webhook.site/7c6037a8-5adf-4cf1-a8c0-0fd1cfdedf14';

      async function logToWebhook(data) {
        await fetch(webhookUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
      }

      const url = new URL(window.location.href);
      logToWebhook({ url: url }).then((data) => { console.log(data); });

      const name = url.searchParams.get('name');
      logToWebhook({ name: name }).then((data) => { console.log(data); });

      const destination = url.searchParams.get('destination');
      logToWebhook({ destination: destination }).then((data) => { console.log(data); });

      const jumpLink = url.searchParams.get('jumpLink'); // should be encoded to preserve its query params
      logToWebhook({ jumpLink: jumpLink, encoded: encodeURIComponent(jumpLink) }).then((data) => { console.log(data); });

      window.onload = function() {
        if (destination === 'digitalRoutines') {
          logToWebhook({ destinationResult: 'Digital Routines' }).then((data) => { console.log(data); });

          window.location.href = `com.gnc.app://push_notification?source=evyd&jumpLink=${encodeURIComponent(jumpLink)}`;
        } else {
          logToWebhook({ destinationResult: 'Homepage' }).then((data) => { console.log(data); });

          window.location.href = "com.gnc.app://homepage?source=evyd";
        }

        // logToWebhook({ userAgent: navigator.userAgent }).then((data) => { console.log(data); });
        // if (navigator.userAgent.match(/Android/i)) {
        //   logToWebhook({ matchResult: 'Android' }).then((data) => { console.log(data); });

        //   setTimeout(function() {
        //     window.location.href = "intent://play.google.com/store/apps/details?id=com.gnc.android.gnc&pcampaignid=web_redirect#Intent;scheme=https;action=android.intent.action.VIEW;package=com.android.vending;S.browser_fallback_url=https://play.google.com/store/apps/details?id=com.gnc.android.gnc&hl=en&gl=US&pli=1&redirect=0;end";
        //   }, 1000);
        // } else if (navigator.userAgent.match(/iPhone|iPad|iPod/i)) {
        //   logToWebhook({ matchResult: 'iPhone|iPad|iPod' }).then((data) => { console.log(data); });

        //   setTimeout(function() {
        //     window.location.href = "https://apps.apple.com/us/app/gnc-livewell/id413258417";
        //   }, 5000);
        // } else if (navigator.userAgent.match(/Windows/i)) {
        //   logToWebhook({ matchResult: 'Windows' }).then((data) => { console.log(data); });

        //   setTimeout(function() {
        //     window.location.href = "https://play.google.com/store/apps/details?id=com.gnc.android.gnc&hl=en&gl=US";
        //   }, 1000);
        // } else {
        //   logToWebhook({ matchResult: 'Something else' }).then((data) => { console.log(data); });

        //   setTimeout(function() {
        //     window.location.href = "https://apps.apple.com/us/app/gnc-livewell/id413258417";
        //   }, 5000);
        // }

      }
    </script>
  </body>
</html>
